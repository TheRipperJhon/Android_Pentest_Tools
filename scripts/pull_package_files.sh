#!/bin/bash
session_dir=$1
package=$2
main_path=/data/data/$package/
sdcard_path=/sdcard/Android/data/$package/

# launch in a separate terminal window
if [ ! -t 1 ]; then
    gnome-terminal -x bash -c "$0 $session_dir $package;bash"
    exit
fi

# create session dir if not exist
mkdir -p $session_dir

# pull files from data dir
adb pull $main_path $session_dir/$package 1>/dev/null

# pull files from sdcard
adb pull $sdcard_path $session_dir/$package/sdcard 1>/dev/null

# init git repository if not exist
if [ ! -d $session_dir/$package/.git ]
then
    git init $session_dir/$package/
fi
git init $session_dir/$package/

# Commit current package state
cd $session_dir/$package/
git add --all
git commit -m "Autocommit: $(date)"
