package com.dsavitski.apt.service.impl;

import com.dsavitski.apt.service.CmdService;
import com.dsavitski.apt.service.ConfigService;
import com.dsavitski.apt.service.ConnectionService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import static com.dsavitski.apt.constants.ConfigKeys.DEVICE_IP;
import static com.dsavitski.apt.constants.ScriptConstants.ADB_PATH;

@Service
public class ConnectionServiceImpl implements ConnectionService {
    private static final String CONNECTED_OK_MARKER = "connected to";
    private static final String DISCONNECT_OK_MARKER = "disconnected everything";

    @Autowired
    private ConfigService configService;
    @Autowired
    private CmdService cmdService;

    @Override
    public boolean connect() {
        String deviceIp = configService.getByKey(DEVICE_IP);
        String output = cmdService.executeCommand(ADB_PATH, "connect", deviceIp);
        return output.contains(CONNECTED_OK_MARKER);
    }

    @Override
    public boolean isConnected() {
        String deviceIp = configService.getByKey(DEVICE_IP);
        String output = cmdService.executeCommand(ADB_PATH, "devices");
        return output.contains(deviceIp);
    }

    @Override
    public boolean disconnect() {
        String output = cmdService.executeCommand(ADB_PATH, "disconnect");
        return output.contains(DISCONNECT_OK_MARKER);
    }
}
