package com.dsavitski.apt.controllers;

import com.dsavitski.apt.daemon.ConnectionDaemon;
import com.dsavitski.apt.service.ConfigService;
import com.dsavitski.apt.service.ConnectionService;
import javafx.fxml.FXML;
import javafx.scene.control.TextField;
import javafx.scene.shape.Circle;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

import static com.dsavitski.apt.constants.ConfigKeys.DEVICE_IP;

/**
 * Connection pane controller
 */
@Controller
public class ConnectController {
    @Autowired
    private ConfigService configService;
    @Autowired
    private ConnectionService connectionService;
    @Autowired
    private ConnectionDaemon connectionDaemon;

    @FXML
    private TextField textDeviceIp;
    @FXML
    private Circle shapeConnectionStatus;

    @FXML
    public void initialize() {
        String deviceIp = configService.getByKey(DEVICE_IP);
        if (deviceIp != null) {
            textDeviceIp.setText(deviceIp);
        }
    }

    @FXML
    public void adbConnect() {
        configService.saveOption(DEVICE_IP, textDeviceIp.getText());
        connectionService.connect();
        connectionDaemon.start(shapeConnectionStatus);
    }

    @FXML
    public void adbDisconnect() {
        connectionService.disconnect();
        connectionDaemon.stop();
    }
}
